{% extends "billerboard/base.html" %} {% load static %} {% load humanize %} {%
load avatar_tags %} {% load custom_filters %} {% block content %}


<div class="page-content">
  <!--end breadcrumb-->
  <!--start stepper three-->
  <h6 class="text-uppercase">Daily Survey Form</h6>
  <hr />
  <div class="card">
    
    <div class="card-body">
      <div id="stepper3" class="bs-stepper gap-4 vertical linear">

        <div class="bs-stepper-header" role="tablist">

          <div class="step active" data-target="#test-vl-0">
            <div class="step-trigger" role="tab" id="stepper3trigger1" aria-controls="test-vl-0" aria-selected="true">
            <div class="bs-stepper-circle"><i class="bx bx-user fs-4"></i></div>
            <div class="">
              <h5 class="mb-0 steper-title">Member</h5>
              <p class="mb-0 steper-sub-title">Select Member</p>
            </div>
            </div>
          </div>
          
          <div class="step" data-target="#test-vl-1">
            <div class="step-trigger" role="tab" id="stepper3trigger1" aria-controls="test-vl-1" aria-selected="true">
            <div class="bs-stepper-circle"><i class="bx bx-user fs-4"></i></div>
            <div class="">
              <h5 class="mb-0 steper-title">Partners</h5>
              <p class="mb-0 steper-sub-title">Enter Your Number</p>
            </div>
            </div>
          </div>
        
          <div class="step" data-target="#test-vl-2">
            <div class="step-trigger" role="tab" id="stepper3trigger2" aria-controls="test-vl-2" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-file fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Partner Name</h5>
                <p class="mb-0 steper-sub-title">Enter Partner Name</p>
              </div>
            </div>
          </div>
        
          <div class="step" data-target="#test-vl-3">
            <div class="step-trigger" role="tab" id="stepper3trigger3" aria-controls="test-vl-3" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bxs-graduation fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">New Kandidates</h5>
                <p class="mb-0 steper-sub-title">Enter Your Number</p>
              </div>
            </div>
          </div>
          
          <div class="step" data-target="#test-vl-4">
              <div class="step-trigger" role="tab" id="stepper3trigger4" aria-controls="test-vl-4" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Kandidate Name</h5>
                <p class="mb-0 steper-sub-title">Enter Kandidate Name</p>
              </div>
              </div>
          </div>

          <div class="step" data-target="#test-vl-5">
              <div class="step-trigger" role="tab" id="stepper3trigger5" aria-controls="test-vl-5" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Kandidate Job</h5>
                <p class="mb-0 steper-sub-title">Kandidate has job</p>
              </div>
              </div>
          </div>

          <div class="step" data-target="#test-vl-6">
              <div class="step-trigger" role="tab" id="stepper3trigger6" aria-controls="test-vl-6" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Kandidate Name</h5>
                <p class="mb-0 steper-sub-title">Enter Kandidate Name</p>
              </div>
              </div>
          </div>

          <div class="step" data-target="#test-vl-7">
              <div class="step-trigger" role="tab" id="stepper3trigger7" aria-controls="test-vl-7" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">New Post</h5>
                <p class="mb-0 steper-sub-title">Number Of Posts</p>
              </div>
              </div>
          </div>

          <div class="step" data-target="#test-vl-8">
              <div class="step-trigger" role="tab" id="stepper3trigger8" aria-controls="test-vl-8" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Vankanz Page</h5>
                <p class="mb-0 steper-sub-title">Number Of Posts</p>
              </div>
              </div>
          </div>

          <div class="step" data-target="#test-vl-9">
              <div class="step-trigger" role="tab" id="stepper3trigger9" aria-controls="test-vl-9" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Doing What</h5>
                <p class="mb-0 steper-sub-title">Job details</p>
              </div>
              </div>
          </div>

          <div class="step" data-target="#test-vl-10">
              <div class="step-trigger" role="tab" id="stepper3trigger10" aria-controls="test-vl-10" aria-selected="false" disabled="disabled">
              <div class="bs-stepper-circle"><i class="bx bx-briefcase fs-4"></i></div>
              <div class="">
                <h5 class="mb-0 steper-title">Rating</h5>
                <p class="mb-0 steper-sub-title">Quality assessment</p>
              </div>
              </div>
          </div>

        </div>

        <div class="bs-stepper-content">
          <form id="surveyForm" onsubmit="return false">
            {% csrf_token %}
            <div id="test-vl-0" role="tabpane3" class="bs-stepper-pane content fade active dstepper-block" >
              <h5 class="mb-1">Member</h5>
              <p class="mb-4">Select team members in the survey</p>
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 0 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}:</label>
                  </div>
                    <div class="col-12 col-lg-12 form-input">
                      <select class="form-select" id="InputCountry" data-question-id={{question.id}}>
                        <option selected="">---</option>
                        {% for member in list_user %}
                        <option value={{member}}>{{member}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  {% endif %}
                {% endfor %}
             
                <div class="col-12">
                  <div class="btn btn-primary px-4" id="nextButton0" onclick="stepper3.next()" >Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                </div>
              </div><!---end row-->
            
            </div>

            <div id="test-vl-1" role="tabpane3" class="bs-stepper-pane content fade">
              <h5 class="mb-1">Number Of Partners</h5>
              <p class="mb-4">Enter the number of partners who book kandidates</p>
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 1 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                  <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}}>
                    <input type="number" class="form-control" id={{question.id}} placeholder="Enter your answer" min="0" max="50" step="1" oninput="validateInput(this)">
                  </div>
                  {% endif %}
                {% endfor %}
             
                <div class="col-12">
                  <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                  <div class="btn btn-primary px-4" id="nextButton1" onclick="stepper3.next()" >Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                </div>
              </div><!---end row-->
            
            </div>

            <div id="test-vl-2" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Partner Name</h5>
              <p class="mb-4">Enter Partner Name</p>
              <div class="row g-3" >
                {% for question in questions%}
                  {% if question.level == 2 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                    <p class="text-danger">*If you do not understand question 1, you can skip this question</p>
                  </div>
              
                <div class="col-12 col-lg-6 form-input" id="partner-details-inputs" data-question-id={{question.id}}>
                  {% comment %} <input type="text" class="form-control mb-3" id={{question.id}} placeholder="Enter your answer"> {% endcomment %}
                </div>
                {% endif%}
                {% endfor %}
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
            
            </div>

            <div id="test-vl-3" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Number of new candidates</h5>
              <p class="mb-4">Enter the number of new candidates</p>
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 3 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}} >
                  <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer" min="0" max="50" step="1" oninput="validateInput(this)">
                </div>
                {% endif %}
                {% endfor %}


                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" id="nextButton3" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>

            <div id="test-vl-4" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Kandidate Name</h5>
              <p class="mb-4">Fill in the number of new kandidates</p>
  
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 4 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                    <p class="text-danger">*If you do not understand question 3, you can skip this question</p>
                  </div>

                  <div class="col-12 col-lg-6 form-input" id="kandidate-details-inputs" data-question-id={{question.id}}>
                    {% comment %} <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer"> {% endcomment %}
                  </div>
                {% endif %}
                {% endfor %}
  
  
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>

            <div id="test-vl-5" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Kandidate Job</h5>
              <p class="mb-4">Enter the number of candidates who found a job on their own</p>
  
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 5 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}}>
                  <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer" min="0" max="50" step="1" oninput="validateInput(this)">
                </div>
                {% endif %}
                {% endfor %}
  
  
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" id="nextButton5" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>

            <div id="test-vl-6" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Kandidate Name</h5>
              <p class="mb-4">Enter the name of the candidate who found the job himself</p>
  
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 6 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                    <p class="text-danger">*If you do not understand question 5, you can skip this question</p>
                  </div>

                  <div class="col-12 col-lg-6 form-input" id="kandidate-job-inputs" data-question-id={{question.id}}>
                    {% comment %} <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer"> {% endcomment %}
                  </div>
                {% endif %}
                {% endfor %}
  
  
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>

            <div id="test-vl-7" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">New Post</h5>
              <p class="mb-4">Number of new posts per day</p>
  
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 7 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}}>
                  <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer">
                </div>
                {% endif %}
                {% endfor %}
  
  
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>

            <div id="test-vl-8" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Vankanz Page</h5>
              <p class="mb-4">Number of new posts per day</p>
  
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 8 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}}>
                  <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer">
                </div>
                {% endif %}
                {% endfor %}
  
  
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>

            <div id="test-vl-9" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Doing What</h5>
              <p class="mb-4">Fill in information about what you will do tomorrow</p>
  
              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 9 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}}>
                  <input type="text" class="form-control" id={{question.id}} placeholder="Enter your answer">
                </div>
                {% endif %}
                {% endfor %}
  
  
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-outline-secondary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <div class="btn btn-primary px-4" onclick="stepper3.next()">Next<i class="bx bx-right-arrow-alt ms-2"></i></div>
                  </div>
                </div>
              </div><!---end row-->
              
            </div>
            
            <div id="test-vl-10" role="tabpane3" class="bs-stepper-pane content fade" >
              <h5 class="mb-1">Rating</h5>
              <p class="mb-4">Can you rate about your past work experience?</p>

              <div class="row g-3">
                {% for question in questions%}
                  {% if question.level == 10 %}
                  <div class="col-12 col-lg-12">
                    <label for={{question.id}} class="form-label">{{question.data}}</label>
                  </div>
                <div class="col-12 col-lg-6 form-input" data-question-id={{question.id}}>
                  <input type="number" class="form-control" id={{question.id}} placeholder="Enter your answer" min="1" max="10" step="1" oninput="validateInput(this)">
                </div>
              
                {% endif %}
                {% endfor %}
                <div class="col-12">
                  <div class="d-flex align-items-center gap-3">
                    <div class="btn btn-primary px-4" onclick="stepper3.previous()"><i class="bx bx-left-arrow-alt me-2"></i>Previous</div>
                    <button class="btn btn-success px-4" onclick="">Submit</button>
                  </div>
                </div>
              </div><!---end row-->
            
            </div> 

             <input type="hidden" id="formDataJson" name="formDataJson" />

          </form>
        </div>
      </div>
    </div>
  </div>
  </div>
  <!--end stepper three-->
</div>
{% endblock %}



{% block scripts %}
<link href="{% static "assets/plugins/bs-stepper/css/bs-stepper.css"%}" rel="stylesheet" />
<script src="{% static "assets/plugins/bs-stepper/js/bs-stepper.min.js"%}"></script>
<script src="{% static "assets/plugins/bs-stepper/js/main.js"%}"></script>
<script>
  stepper3 = new Stepper(document.querySelector("#stepper3"));
  
  document.querySelector('.btn-success').addEventListener('click', function() {
    event.preventDefault();
    let formData = [];
    let selectedValues ;
    const selects = document.querySelectorAll('#test-vl-0 select');

    selects.forEach(select => {
      const selectedValue = select.value;
      if (selectedValue) {
        selectedValues = selectedValue;
      }
    });

    // Get all input elements inside the form
      let inputs = document.querySelectorAll('.form-input');
      inputs.forEach(section => {
        let answers = [];
        const questionId = section.dataset.questionId;
        const inputs = section.querySelectorAll('.form-control');
        if(inputs.length > 0) {
          let answers = [];
          inputs.forEach((input) => {
            answers.push(
               input.value
            );
          });
          formData.push({
            question_id: Number(questionId),
            answer: answers
          });
        }
      })
      const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
      let test =  [{
        'anrede': 'Herr',
        'position': 'string',
        'vorname': 'string',
        'email': 'string',
        'telefon': 'string',
        'nachname': 'string',
        'kontakt_hubspotid': 'string',
        'doer': 'string',
        'ist_ansprechpartner': true,
        'berufsbezeichnung': 'string'
      },
      {
        'anrede': 'Frau',
        'position': 'string',
        'vorname': 'string',
        'email': 'string',
        'telefon': 'string',
        'nachname': 'string',
        'kontakt_hubspotid': 'string',
        'doer': 'string',
        'ist_ansprechpartner': false,
        'berufsbezeichnung': 'string'
      },
      {
        'anrede': 'Herr',
        'position': 'string',
        'vorname': 'string',
        'email': 'string',
        'telefon': 'string',
        'nachname': 'string',
        'kontakt_hubspotid': 'string',
        'doer': 'string',
        'ist_ansprechpartner': true,
        'berufsbezeichnung': 'string'
      }]
      console.log(test)
      const body = {
        formData,
        user_survey: selectedValues,
        formKandidates: test
        // TODO Kandidate Forms here
      }
      fetch('/dailysurvey/', {
        method: 'POST', 
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrfToken
        },
        body: JSON.stringify(body) 
      })
      .then(response => console.log(response))
  });
</script>

 <script>
  // Hàm xử lý sự kiện khi giá trị trường input thay đổi
  function validateInput(inputElement ) {
    console.log(inputElement.min)
    let value = parseInt(inputElement.value, 10);
    const max = inputElement.max;
    const min = inputElement.min;
    // Kiểm tra nếu giá trị là NaN hoặc ngoài phạm vi cho phép
    if (isNaN(value)) {
      inputElement.value = min; // Đặt giá trị tối thiểu nếu giá trị không phải số
    } else if (value < min) {
      inputElement.value = min; // Đặt giá trị tối thiểu nếu giá trị âm
    } else if (value > max) {
      inputElement.value = max; // Đặt giá trị tối đa nếu giá trị vượt quá
    }
  }
  document.getElementById('nextButton1').addEventListener('click', function() {
    // Collect input values from the current step
    const numberOfInputs = document.querySelectorAll('#test-vl-1 input')[0].value;
    let container = document.getElementById('partner-details-inputs');

      // Xóa tất cả các ô input hiện tại
       container.innerHTML = '';

      for (let i = 0; i < numberOfInputs; i++) {
        // Create a new input element
        let input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control mb-3';
        input.id = `partner-input-${i}`;
        input.placeholder = 'Enter your answer';
        
        // Append the new input to the container
        container.appendChild(input);
      }

});
</script>  

<script>

  document.getElementById('nextButton3').addEventListener('click', function() {
    // Collect input values from the current step
    const numberOfInputs = document.querySelectorAll('#test-vl-3 input')[0].value;
    let container = document.getElementById('kandidate-details-inputs');

      // Xóa tất cả các ô input hiện tại
       container.innerHTML = '';

      for (let i = 0; i < numberOfInputs; i++) {
        // Create a new input element
        let input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control mb-3';
        input.id = `kandidate-input-${i}`;
        input.placeholder = 'Enter your answer';
        
        // Append the new input to the container
        container.appendChild(input);
      }

});
</script>  

<script>
  document.getElementById('nextButton5').addEventListener('click', function() {
    // Collect input values from the current step
    const numberOfInputs = document.querySelectorAll('#test-vl-5 input')[0].value;
    let container = document.getElementById('kandidate-job-inputs');

      // Xóa tất cả các ô input hiện tại
       container.innerHTML = '';

      for (let i = 0; i < numberOfInputs; i++) {
        // Create a new input element
        let input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control mb-3';
        input.id = `job-input-${i}`;
        input.placeholder = 'Enter your answer';
        
        // Append the new input to the container
        container.appendChild(input);
      }
});
</script>


{% endblock scripts %}
